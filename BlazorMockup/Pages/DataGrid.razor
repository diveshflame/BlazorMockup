@using System.Net.Http.Json
@inject HttpClient httpClient
@using MudBlazor
@using BlazorMockup.Model

<MudDataGrid T="Examination" MultiSelection="true"
            Items="@Examinations.Take(4)" Hover="true" Striped="@true" Bordered="true"
             RowStyleFunc="@_rowStyleFunc" Filterable="false" ShowFilterIcons="false"
              SortMode="@SortMode.Single" Groupable="false" 
              @bind-SelectedItems="@SelectedExaminations">
    <Columns>
        <SelectColumn T="Examination" />
        <PropertyColumn Property="x => x.Date" Title="Date"/>
        <PropertyColumn Property="x => x.ExaminationType" Title="Examination Type"/>
        <PropertyColumn Property="x => x.Weight" Title="Weight" Sortable="false"/>
        <PropertyColumn Property="x => x.HeadCircumference" Title="Head Circumference" Sortable="false"/>
        <PropertyColumn Property="x => x.Height" Title="Height" Sortable="false"/>
        <PropertyColumn Property="x => x.Note" Title="Note" Sortable="false"/>
        <TemplateColumn StickyRight="true">
            <CellTemplate>
                <MudIconButton Icon="@Icons.Material.Outlined.Edit" Size="@Size.Small" />
            </CellTemplate>
        </TemplateColumn>
    </Columns>
</MudDataGrid>

@code {
    private HashSet<Examination> SelectedExaminations = new HashSet<Examination>();
    private DataWarehouse.DataStore _dataStore = new DataWarehouse.DataStore();
    private IEnumerable<Examination> Examinations ;
    // style the rows where the Examination.Date == DateTime.Now.Date to have italic text.
    private Func<Examination, int, string> _rowStyleFunc => (x, i) =>
    {
        if (x.Date.Date == DateTime.Now.Date)
            return "font-style:italic";

        return "";
    };
    // style the cells according to the examination type.
    private Func<Examination, string> _cellStyleFunc => x =>
    {
        string style = "";

        if (x.ExaminationType == "Type1")
            style += "background-color:#8CED8C";

        else if (x.ExaminationType == "Type2")
            style += "background-color:#E5BDE5";

        else if (x.ExaminationType == "Type3")
            style += "background-color:#EACE5D";

        else if (x.ExaminationType == "Type4")
            style += "background-color:#F1F165";

        return style;
    };

    protected override async Task OnInitializedAsync()
    {
        Examinations = _dataStore.Examinations;
    }
}